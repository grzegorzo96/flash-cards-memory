---
import Layout from "@/layouts/Layout.astro";
import ResetPasswordPage from "@/components/auth/ResetPasswordPage";

export const prerender = false;

const supabase = Astro.locals.supabase;

// Check for recovery mode (link from email)
const token = Astro.url.searchParams.get('token');
const type = Astro.url.searchParams.get('type');
const isRecoveryMode = !!(token && type === 'recovery');

// Verify token if in recovery mode
let tokenValid = false;
if (isRecoveryMode && token) {
  const { error } = await supabase.auth.verifyOtp({
    token_hash: token,
    type: 'recovery',
  });
  tokenValid = !error;
}
---

<Layout title="Reset hasÅ‚a - FlashCardMemory">
  <ResetPasswordPage 
    client:load 
    isRecoveryMode={isRecoveryMode}
    tokenValid={tokenValid}
  />
</Layout>
